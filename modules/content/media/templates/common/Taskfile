# https://taskfile.dev

version: '3'

env:
  FILELIST_FILENAME: files.list

tasks:
  download:yt:
    desc: Download youtube videos/playlist with youtube-dl, get data from clipboard
    cmds:
      - youtube-dl -o "%(title)s.%(ext)s" `xsel -b -o`

  download:pytube:
    desc: Download youtube videos/playlist with pytube, get data from clipboard
    cmds:
      - pytube `xsel -b -o`

  encode:camcorder:
    desc: Download youtube videos/playlist with pytube, get data from clipboard
    cmds:
      - for i in *.MTS; do ffmpeg -i "$i" -c:v copy -c:a copy -b:a 192k "$i.mp4"; done

  encode:camcorder:mkfilelist:
    desc: make video files list
    cmds:
      - rm -f $FILELIST_FILENAME
      - touch $FILELIST_FILENAME
      - for i in *.MTS; do echo "$i" >> $FILELIST_FILENAME; done

  encode:camcorder:merge:
    desc: Merge video chunks
    cmds: # not tested yet
      - ffmpeg -f concat -i files.list -c copy result.mp4

  encode:camcorder:mkfilelist:
    desc: make video files list
    cmds:
      - mkdir -p result
      - for i in *.mp4; do ffmpeg -i "$$i" -codec:a libmp3lame "result/$${i%.*}.mp3"; done
      - for i in *.mkv; do ffmpeg -i "$$i" -codec:a libmp3lame "result/$${i%.*}.mp3"; done
      - for i in *.webm; do ffmpeg -i "$$i" -codec:a libmp3lame "result/$${i%.*}.mp3"; done

  encode:cleanup:
    desc: Remove generated data
    cmds:
      - rm -rf ./result
